# Changelog

All notable changes to this project will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## [2.4.0] - 2026-01-22

### Changed
- **Excel出力仕様変更（市役所要望対応）**
  - C列・E列: ラベルを「コード」に変更、int型8桁固定
  - F列: int型7桁固定
  - H列: ラベルを「氏名カナ」に変更
  - I列: 日付型（シリアル値）、yyyy/m/d形式（ゼロ埋めなし）
  - J列: ラベルを「調剤年月日」に変更、日付型、月初来局日のみ出力
  - K列: ラベルを「社保」に変更
  - M列: ラベルを「難病」に変更

- **月跨ぎデータ処理改善**
  - 同一患者で月を跨ぐ場合は複数行に分割
  - 今月分が先、前月分（月遅れ）が後に配置

### Fixed
- **J列参照元変更**
  - CSV 56列目（最終来局日）→ 55列目（月初来局日）に変更
  - 市役所要望: 月の最初の来局日を使用

### Technical
- Standalone版: v2.4.0
- Webapp版: v2.4.0
- Test版: v2.4.0

---

## [2.3.12] - 2026-01-20

### Added
- **ANSIエンコーディング優先モード**
  - 2026年1月から本番データがANSI（BOMなしShift-JIS）形式に変更されたことに対応
  - エンコーディング選択UI追加（ANSI優先/UTF-8優先/自動検出）
  - 設定はlocalStorageに保存され、次回以降も維持

### Fixed
- **Encoding.detect()の誤検出問題**
  - ANSIファイルが「UNICODE」と誤検出される問題を修正
  - ANSI優先モードでは検出結果を無視し、強制的にShift-JISとして処理

### Technical
- Standalone版: v2.3.12
- Webapp版: v2.1.0（encoding-japaneseライブラリ追加）

---

## [2.3.11] - 2026-01-18

### Fixed
- **CSV文字化け（□文字）問題の解決**
  - UTF-8/Shift-JIS の自動判定機能を実装
  - レセコンのエンコーディングが月によって異なる問題に対応
  - BOM検出機能追加（UTF-8 with BOM対応）

### Added
- **複数エンコーディング試行機能**
  - 優先順位: UTF-8 (BOM付き) → UTF-8 (BOMなし) → Shift-JIS
  - 文字化けチェック機能（□や�の検出）
  - 自動フォールバック処理

### Improved
- **デバッグ強化**
  - 検出されたエンコーディングをコンソールに詳細表示
  - デコード後のテキストサンプル表示（200文字）
  - UIにエンコーディング情報を表示（ファイル名の横）

## [2.3.10] - 2026-01-18

### Changed
- 前月分データのチェックボックスをデフォルトオフに変更
  - 99%のデータが請求済みと想定されるため、手動選択が必要な未請求データのみをチェック
  - 「全選択/全解除」チェックボックスもデフォルトオフ
  - 統計情報「請求対象」も初期状態は0件表示

### Improved
- UX改善: ユーザーが明示的に未請求データを選択する設計に変更

## [2.3.9] - 2026-01-18

### Added
- 前月分CSV追加機能の実装（月遅れ請求対応）
  - 当月分データ読み込み後、前月分データを追加できるようになりました
  - 前月分データは重複チェックの対象外として処理されます
  - UI: data-view内に「前月分CSVファイルを選択」ボタンを配置

### Fixed
- 前月分アップロードボタンがdata-view表示時に見えなかった問題を修正
  - upload-viewからdata-viewに配置を移動
  - 当月分読み込み後、統計情報の下に表示されるように変更

### Changed
- 前月分データ表示セクションのUI改善
  - 統計情報に「月遅れ請求」専用カウンターを追加
  - 前月分データテーブルに「月遅れ請求」バッジを表示

## [2.3.8] - 2026-01-18

### Fixed
- 前月分データ処理のロジック修正
  - 当月分と同じCSV解析処理を使用
  - 旭川市データ抽出フィルタの実装
  - ステータス表示とエラーハンドリングの改善

## [2.3.7] - 2026-01-17

### Added
- クリーン版テンプレート（tyouzai_excel_v2_clean.xlsx）の組み込み
- テーブル機能付きExcel生成機能
  - フィルタリング、ソート、テーブルデザイン適用

### Fixed
- Excel生成時のテーブル範囲エラーを修正
- テーブルXML整合性の確保

## [2.3.0] - 2026-01-15

### Added
- 前月分CSV追加機能の初期実装（試験版）

## [2.0.0] - 2026-01-10

### Added
- スタンドアロン版の初回リリース
- CSVアップロード機能
- Excel自動生成機能
- 旭川市データ自動抽出
- 重複チェック機能（2回目請求）
- 他公費検出機能
